<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:cq="http://www.day.com/jcr/cq/1.0" xmlns:jcr="http://www.jcp.org/jcr/1.0"
	jcr:primaryType="cq:Dialog" title="Event schedule" xtype="dialog">
	<listeners jcr:primaryType="nt:unstructured"
		beforesubmit="
			function(dialog){
				console.log(dialog);
				  var dialogItems = dialog.initialConfig.items.items.items;
				  console.log(dialog.initialConfig.items.items.items);
				  
				  var newItems = {'jcr:primaryType':'cq:Widget', name:'../../../../jcr:datesRecurrence', stateful:false, xtype:'textfield, msgTarget:qtip, anchor:94%};
				  console.log(newItems);
				
				  dialog.initialConfig.items.items.items[dialogItems.length] = newItems;
				  console.log(dialog.initialConfig.items.items.items);
				
				  var path = dialog.path;
				  
				  var pathParts=path.split('/');
				  pathParts.pop();
				  pathParts.pop();
				  pathParts.pop();
				  pathParts.pop();
				  
				  var jcrContentPath=pathParts.join('/');
				  
				  var response = CQ.utils.HTTP.get(jcrContentPath +'.json');
				
				  return true;
				}" />
	<items jcr:primaryType="cq:Widget" 
		xtype="tabpanel">
		<items jcr:primaryType="cq:WidgetCollection">
			<tab1 jcr:primaryType="cq:Panel" 
				title="Sold Out Events">
				<items jcr:primaryType="cq:WidgetCollection">
					<times jcr:primaryType="cq:Widget" 
						name="../../../../jcr:timesRecurrence"
						xtype="textfield">
						<listeners jcr:primaryType="nt:unstructured"
							beforeloadcontent="
			          			function(field, record, path) {
								  var targetField=field.getName().replace('./','');
								  
								  var pathParts=path.split('/');
								  pathParts.pop();
								  pathParts.pop();
								  pathParts.pop();
								  pathParts.pop();
			
								  var jcrContentPath=pathParts.join('/');
								  
								  var response = CQ.utils.HTTP.get(jcrContentPath +'.json');
								  eval('var data ='+response.responseText);
								  var originalPropName=&quot;jcr:timesRecurrence&quot;;
								  
								  if(data[originalPropName]!=undefined) {
								      var originalPropVal=data[originalPropName];
								      this.setValue(originalPropVal);
								      return false;
								  }
								}" />
					</times>
					<soldout jcr:primaryType="cq:Widget" name="../../../../jcr:soldOut"
						xtype="textfield">
						<listeners jcr:primaryType="nt:unstructured"
							beforeloadcontent="
			          			function(field, record, path) {
								  var targetField=field.getName().replace('./','');
								  
								  var pathParts=path.split('/');
								  pathParts.pop();
								  pathParts.pop();
								  pathParts.pop();
								  pathParts.pop();
			
								  var jcrContentPath=pathParts.join('/');
								  
								  var response = CQ.utils.HTTP.get(jcrContentPath +'.json');
								  eval('var data ='+response.responseText);
								  var originalPropName=&quot;jcr:soldOut&quot;;
								  
								  if(data[originalPropName]!=undefined) {
								      var originalPropVal=data[originalPropName];
								      this.setValue(originalPropVal);
								      return false;
								  }
								}" />
					</soldout>
				</items>
			</tab1>
		</items>
	</items>
</jcr:root>
